<!DOCTYPE html>
<html>
    <head>
        <title>第14页</title>
        <meta charset="utf-8"/>
        <style type="text/css">
            html,body{
                width: 100%;
                height: 100%;
                overflow:hidden;
                margin:0 auto;
                position:relative;
            }
            body{
                background-image: url("Images/ModelPageImages/PageOneBackground.png");
                display: flex;
                justify-content: center;
                align-items: center;
                background-repeat: no-repeat;
                background-size: cover;
            }
            .BookDivDiv{

                display: flex;
                justify-content: center;
                align-items: center;
                background-repeat: no-repeat;
                background-size: cover;
                transform:scale(1.55);

            }
            .BookDiv{
                width:1000px;
                height:563px;
                overflow: hidden;
                
                /* transition: all 3s linear 0s; */
                transform:translate(-50px,0);
                position: absolute;
                display: flex;                /* 子元素横向排列 */
                align-items: center;
            }
            .BookDivson{
                display: inline-block;
                flex: 0 0 1000px; /* width:1000px; */
                height:562.5px;
                position: relative;
                transition: all 3s linear 0s;
            }
            .overBook{
                 width: 1000px;

                height: auto;
                position: absolute;
                margin: 0 auto; /* 居中显示 */
            }
            .leftBook{
                position: absolute;

                width: 130px;
                height: 665px;
                /* transform:translate(-70px,8px); */
                z-index: 1;
                transition: all 3s linear 0s;
                transform:translate(-590px,8px);
            }
            .rightBook{
                
                position: absolute;
                width: 270px;
                /* width:260px; */
                z-index: 1;
                transform:translate(552px,0);
            }
            .nextImage{
                left: 900px;
                bottom: 25px;
                cursor: pointer;
                position: absolute;
            }
            .lastImage{
                left: 50px;
                bottom: 25px;
                cursor: pointer;
                position: absolute;
            }

            .nextImage:hover{
                transform: scale(1.3);
            }
            .lastImage:hover{
                transform: scale(1.3);
            }

            .materialDiv{
                width: 100px;
                position: absolute;
                aspect-ratio: 1 / 1;
                /* border: 1px solid black;
                border-radius: 50%;
                
                overflow: hidden; */

                pointer-events: none;
            }

            .materialDivDiv{
                width: 100px;
                position: absolute;
                aspect-ratio: 1 / 1;
                border: 1px solid black;
                border-radius: 50%;
                
                overflow: hidden;

            }

            .materialDivDiv > img{
                width: 130px;
                position: absolute;
                left: -15px;
                
            }

            .hotPotDiv{
                width: 200px;
                position: absolute;
                left: 380px;
                top:120px;
                /* transform: translate(0,-40px); */
            }
            .hotPotDivImage{
                width: 300px;
                position: absolute;
            }

            .materialIamges{
                width: 130px;
                position: absolute;
                left: -15px;
                cursor: pointer;
                pointer-events: auto;
                /* -webkit-user-drag: none !important; */
                z-index: 10;

                
            }

            .materialCutImage{
                width: 100px;
                aspect-ratio: 61 /33;
                position: absolute;
                top: -10px;
                left: 40%;
                opacity: 0;

                z-index: 2;
                /* transition: opacity 2s ease-in-out; */

                animation: fadeIn 4s ease-in-out 0.5s forwards;
                
            }

            .progressall{
                position: absolute;
                left:280px;
                /* top: 490px; */
                z-index: 100;
                top: 600px;
                
            }
            .progressgif{
                position: absolute;
                width:20px;
                transition: transform 22s linear ;
                top: -40px;
                left: 5px;
            }
            .progressLine{
                height: 20px;
                width:450px;
                overflow: hidden;
                border-radius: 20px;
                background-color: rgb(159, 161, 159);
                border: 3px solid rgb(97, 83, 83);
                

            }
            .proLine{
                height: 20px;
                width:450px;
                background-color: green;
                border-radius: 20px;
                position: relative;
                Left:-450px;
                transition: transform 5s linear 1s;

            }

            .leafLine{
                height: 20px;
                width:auto;
                position: relative;
                display: flex;
                left: 10px;
            }
            .leafLineDiv{
                height: 20px;
                width:auto;
                display: flex;
            }
            .leafC{
                height: 20px;
                width:auto;


                
            }
            #leafA{
                opacity: 0;
                animation: leafIn 0.5s ease-in-out  forwards;
            }
            #leafB{
                opacity: 0;
                animation: leafIn 0.5s ease-in-out  forwards;
            }

            @keyframes fadeIn {
                0% {
                    opacity: 0;
                    transform: scale(0.8);
                }
                50% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    opacity: 1;
                    transform: translate(0,70px);
                }
            }

            @keyframes fadeOut {
                0% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.8);
                }
            }

            @keyframes hotPotUP {
                100% {
                    transform: translate(0,-40px);
                }
            }

            @keyframes progressAllUP{
                100% {
                    transform: translate(0,-110px);
                }
            }

            @keyframes shaoziDown{
                100% {
                    transform: translate(0,250px);
                }
            }

            @keyframes shaoziCircle {
                0%{
                    transform: translate(0,0);
                }
                /* 12.5%{
                    transform: translate(-24px,-5px);
                } */

                25%{
                    transform: translate(-55px,0);
                }

                /* 37.5%{
                    transform: translate(-24px,-12px);
                }

                50%{
                    transform: translate(0,-20px);
                }
                62.5%{
                    transform: translate(22px,-12px);
                } */

                75%{
                    transform: translate(40px,0);
                }

                /* 87.5%{
                    transform: translate(22px,-5px);
                } */
                100%{
                    transform: translate(0,0);
                }
            }
            @keyframes leafIn{
                100%{
                    opacity: 1;
                }
            }
        </style>
        <script type="text/javascript">
            let leafNum = 0;
            function createLeaf(){
                const leafLine = document.querySelector(".leafLine");
                const leafLineDiv = document.querySelector(".leafLineDiv");
                const leafC = document.createElement('img');
                const leafAB = document.createElement('img');


                leafC.src = "Images/onloadLine/greenLeaf.png";
                leafC.className="leafC";

                leafAB.src = "Images/onloadLine/greenLeaf.png";
                leafAB.className="leafC";
                
                if(leafNum%2==0){
                    if(leafNum!=0){
                        leafLine.insertBefore(leafC, leafLine.firstChild);
                        const itemA = document.getElementById("leafA");
                        const itemB = document.getElementById("leafB");
                        
                        
                        itemA.remove();
                        itemB.remove();
                    }

                    leafAB.style.position="absolute";
                    leafAB.src = "Images/onloadLine/yellowLeaf.png";
                    leafAB.id="leafA";
                    leafLineDiv.appendChild(leafAB);

                }else if(leafNum%2==1){

                    leafAB.style.position="absolute";
                    leafAB.src = "Images/onloadLine/greenLeaf.png";
                    leafAB.id="leafB";
                    leafLineDiv.appendChild(leafAB);
                    
                    
                }

                leafNum++;
                setTimeout(() =>{
                    createLeaf();
                },500)
            }
            

            function onProgress(){
                // onProgressLine();
                onProgressgif();


                function onProgressLine(){
                    const PL = document.querySelector(".proLine");
                    PL.style.transform = "translate(450px,0px)";
                }
                function onProgressgif(){
                    const PL = document.querySelector(".progressgif");
                    PL.style.transform = "translate(440px,0px)";
                }
            }
            

            
            function changePage(i){
                if(i=="1"){
                    window.location.replace("");
                }else if(i=="-1"){
                    window.location.replace("pageThirteen.html");
                }
            }
        </script>
    </head>
    <body >
        <!-- <a href="PageTwo.html"><img class="PageOneCoin" src="Images/PageOneIcon.png" alt="牡丹亭" /></a> -->
         <div  class="BookDivDiv">
            <img  class="leftBook" src="Images/ModelPageImages/LeftFrame.png" />

            <div class="BookDiv" >
                <div  class="BookDivson">
                    <img  class="overBook" src="Images/ModelPageImages/downBG.png"  /> 

                    <div class = "materialDiv" style="left: 160px;top: 70px;">
                        <div class = "materialDivDiv">
                            <img  src="Images/PageElevenImages/materialDownBook.png" />
                        </div>
                        
                        <img class="materialIamges" draggable="true"  data-index="1" src="Images/PageElevenImages/material_1.png" />
                    </div>
                    <div class = "materialDiv" style="left: 60px;top: 210px;">
                         <div class = "materialDivDiv">
                            <img  src="Images/PageElevenImages/materialDownBook.png" />
                        </div>
                        <img class="materialIamges" draggable="true"  data-index="2" src="Images/PageElevenImages/material_2.png" />
                    </div>
                    <div class = "materialDiv" style="left: 160px;top: 350px;">
                         <div class = "materialDivDiv">
                            <img  src="Images/PageElevenImages/materialDownBook.png" />
                        </div>
                        <img class="materialIamges" draggable="true"  data-index="3" src="Images/PageElevenImages/material_3.png" />
                    </div>
                    <div class = "materialDiv" style="left: 760px;top: 70px;">
                         <div class = "materialDivDiv">
                            <img  src="Images/PageElevenImages/materialDownBook.png" />
                        </div>
                        <img class="materialIamges" draggable="true"  data-index="4" src="Images/PageElevenImages/material_4.png" />
                    </div>
                    <div class = "materialDiv" style="left: 860px;top: 210px;">
                         <div class = "materialDivDiv">
                            <img  src="Images/PageElevenImages/materialDownBook.png" />
                        </div>
                        <img class="materialIamges" draggable="true"  data-index="5" src="Images/PageElevenImages/material_5.png" />
                    </div>
                    <div class = "materialDiv" style="left: 760px;top: 350px;">
                         <div class = "materialDivDiv">
                            <img  src="Images/PageElevenImages/materialDownBook.png" />
                        </div>
                        <img class="materialIamges" draggable="true"  data-index="6" src="Images/PageElevenImages/material_6.png" />
                    </div>
                    
                    <!--中间药罐子-->
                    <div class = "hotPotDiv">
                        <img class = "hotPotDivImage" src="Images/PageElevenImages/hotPot_down.png" style="z-index: 1;"/>
                        <img class = "hotPotDivImage" src="Images/PageElevenImages/hotPot_up.png" style="z-index: 4;"/>

                        
                        <img id="shaozi" src="Images/PageElevenImages/shaoZiA.png"  style="
                        z-index: 3;
                        width: 100px;
                        aspect-ratio: 607 /802;
                        position: absolute;
                        left: 40%;
                        filter: drop-shadow(0 0 4px rgba(224, 174, 10, 0.8));
                        
                        "/>
                    </div>

                    <!-- 进度条 -->
                    <div class="progressall">
                        <img class="progressgif" src="Images/onloadLine/onloadHuman.gif" alt="动图">
                        <div class="progressLine">
                            <div class="leafLine">
                                <div class="leafLineDiv"></div>
                            </div>
                        </div>
                    </div>


                    <img class="nextImage" src="Images/ModelPageImages/RightBT.png"  onclick="changePage(1)"/>
                    <img class="lastImage" src="Images/ModelPageImages/LeftBT.png"  onclick="changePage(-1)"/>
                </div>
                
            </div>

            <img class="rightBook" src="Images/ModelPageImages/RightFrame.png" />
         </div>
        
        <script>
            const materialIamge = document.getElementsByClassName("materialIamges");
            let cardIsDragging = false;
            let currentX;
            let currentY;
            let initialX;//初始X
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            let placedCount = 0; 

            let TheConstPuImageSon;
            //防止默认拖拽
            document.addEventListener('dragstart', (e) => {
                // 判断目标是否是需要处理的 div（带 no-default-drag 类）
                if (e.target.classList.contains('materialIamges')) {
                e.preventDefault(); // 取消默认拖拽行为
                e.stopPropagation();//取消事件扩散
                }
            });

            for(let i=0;i<materialIamge.length;i++){
                const a = materialIamge[i];
                a.addEventListener('mousedown', function (e) {
                    cardDragStart(a,e);
                });

            }
            document.addEventListener('mousemove', cardDrag);
            document.addEventListener('mouseup', cardDragEnd);



            function cardDragStart(ThePuImageSon,e) {//传入div对象
            // 获取初始位置
                cardIsDragging = true;

                TheConstPuImageSon=ThePuImageSon;

                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;

                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                setTranslate(currentX, currentY, ThePuImageSon);

            }

            function setTranslate(xPos, yPos, el) {//改变位置
                el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
            }

            function getTranslateY(element) {
                // 1. 获取元素计算后的 transform 样式
                const transform = window.getComputedStyle(element).getPropertyValue('transform');
                
                // 2. 如果没有 transform 变换（值为 'none'），返回 0
                if (transform === 'none') {
                    return 0;
                }

                // 3. 解析矩阵（支持 2D matrix 和 3D matrix3d）
                const matrix = new DOMMatrix(transform); // 用 DOMMatrix 解析矩阵

                // 4. 2D 矩阵的 y 偏移在 matrix.f；3D 矩阵在 matrix.m42（等价于索引 13）
                return matrix.is2D ? matrix.f : matrix.m42;
            }

            function cardDrag(e){
                if (cardIsDragging) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    currentX = (e.clientX - initialX) / 1.55;;
                    currentY = (e.clientY - initialY) / 1.55;;
                    xOffset = currentX;
                    yOffset = currentY;
                    
                    // 设置元素位置
                    setTranslate(currentX, currentY,TheConstPuImageSon);

                    // const garbageCan = document.getElementById("garbageCan");
                    // checkDropZone(e,garbageCan);
                }
            }
            function cardDragEnd(e) {
                

                //松开鼠标时结束拖拽
                if(cardIsDragging == true){
                    cardIsDragging = false;
                    const aax = e.pageX;
                    const aay = e.pageY;

                    // 获取下层元素（假设它在顶层下方）
                    const originalDisplay = TheConstPuImageSon.style.display;
                    TheConstPuImageSon.style.display = 'none';

                    const target = document.elementFromPoint(aax, aay);

                    TheConstPuImageSon.style.display = originalDisplay;
                    // 如果命中底层元素，手动触发 hover 效果
                    if (target.className === "hotPotDivImage") {

                        placedCount++;
                        createCutImage(TheConstPuImageSon.dataset.index);
                        TheConstPuImageSon.remove();
                         checkComplete();
                    } else {

                    }

                    TheConstPuImageSon.style.transform = ''; 
                    // 重置偏移量，避免下次拖拽受影响
                    xOffset = 0;
                    yOffset = 0;

                    
                } 
            }


            function createCutImage(i){
                const hotPotDiv=document.querySelector(".hotPotDiv");
                const aCutImage = document.createElement('img');
                const bMaterialImage = document.createElement('img');

                aCutImage .alt = '动态生成的图片';
                aCutImage .className="materialCutImage";

                bMaterialImage.alt = '动态生成的图片';
                bMaterialImage.className="materialIamges";
                
                bMaterialImage.style.animation="fadeOut 2s ease-in-out 0.5s forwards";
                bMaterialImage.style.left="35%";
                bMaterialImage.style.top="-40px";
                if(i==1){
                    aCutImage.src = 'Images/PageElevenImages/materialCutImages/materialCut_1.png'; 
                    bMaterialImage.src="Images/PageElevenImages/material_1.png";
                }else if(i==2){
                    aCutImage .src = 'Images/PageElevenImages/materialCutImages/materialCut_2.png'; 
                    bMaterialImage.src="Images/PageElevenImages/material_2.png";
                }else if(i==3){
                    aCutImage.src = 'Images/PageElevenImages/materialCutImages/materialCut_3.png'; 
                    bMaterialImage.src="Images/PageElevenImages/material_3.png";
                }else if(i==4){
                    aCutImage.src = 'Images/PageElevenImages/materialCutImages/materialCut_4.png'; 
                    bMaterialImage.src="Images/PageElevenImages/material_4.png";
                }else if(i==5){
                    aCutImage.src = 'Images/PageElevenImages/material_5.png'; 
                    bMaterialImage.src="Images/PageElevenImages/material_5.png";
                }else if(i==6){
                    aCutImage.src = 'Images/PageElevenImages/material_6.png'; 
                    bMaterialImage.src="Images/PageElevenImages/material_6.png";
                }

                hotPotDiv.appendChild(aCutImage);
                hotPotDiv.appendChild(bMaterialImage);
                
                setTimeout(function(){
                    bMaterialImage.remove();
                },3000)
            }
            //动画函数


            // 检查是否全部归位
            function checkComplete() {
               
                if (placedCount === 6) {
                    setTimeout(() => {
                        const hotPotDiv=document.querySelector(".hotPotDiv");
                        hotPotDiv.style.animation="hotPotUP 1.75s ease-in-out 0.25s forwards";

                        const progressAll=document.querySelector(".progressall");
                        progressAll.style.animation="progressAllUP 1.75s ease-in-out 0.25s forwards";

                        const shaozi=document.querySelector("#shaozi");
                        
                        hotPotDiv.addEventListener('click', (e) => {
                            shaozi.style.animation="shaoziCircle 1.75s ease-in-out infinite forwards";
                            createLeaf();
                            onProgress();
                        });

                        
                    }, 4500);
                }
            }


        </script>

    </body>
</html>